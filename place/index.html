<!DOCTYPE html>

<html>
  <head>
    <style type="text/css">
      html, body {
        margin: 0;
        -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-size: 24px;
      }

      .swatch {
        border-radius: 10px;
        border: 1px solid #999999;
        width: 100%;
        height: 10vh;
      }

      .container {
        padding: 20px;
      }

      .game-container {
        display: grid;
        gap: 10px;
        margin-bottom: 20px;
      }

      canvas {
        margin: auto;
      }

      .url {
        margin: auto;
        display: block;
      }

      .colors {
        width: calc(100vw - 36px);
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        gap: 4px;
        position: fixed;
        bottom: 1vh;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="game-container">
        <canvas id="game" width="500" height="500" style="border: 1px solid black">

        </canvas>
        <a class="url">Share</a>
      </div>

      <div class="colors">

      </div>

    </div>

    <script type="text/javascript">
      class Coord {
        constructor (x, y, color) {
          this.x = x;
          this.y = y;
          this.colorIndex = color;
        }

        get details() {
          return `${this.x.padStart(2, '0')},${this.y.padStart(2, '0')},${this.colorIndex}`
        }
      }

      const colors = [
        "#FF4500",
        "#FFA800",
        "#FFD635",
        "#00A368",
        "#7EED56",
        "#2450A4",
        "#3690EA",
        "#51E9F4",
        "#811E9F",
        "#B44AC0",
        "#FF99AA",
        "#9C6926",
        "#000000",
        "#898D90",
        "#D4D7D9",
        "#FFFFFF"
      ]
      const game = document.getElementById('game')
      const ctx = game.getContext('2d');
      ctx.imageSmoothingEnabled = false;
      ctx.fillStyle = colors[0];
      const colorSwatchBar = document.querySelector(".colors");
      const size = 25;
      let log = [];
      const url = document.querySelector(".url");


      for (let [name, color] of Object.entries(colors)) {
        const swatch = document.createElement("div")
        swatch.classList.add("swatch")
        swatch.style.backgroundColor = color
        swatch.style.borderRadius = "10px"
        swatch.style.width = `100%`;
        swatch.onclick = (e) => {
          ctx.fillStyle = e.currentTarget.style["background-color"]
        }
        colorSwatchBar.appendChild(swatch)
      }

      const boundaries = game.getBoundingClientRect();

      const draw = (x, y, colorIndex) => {
        ctx.fillStyle = colors[colorIndex];
        const relativeX = x * size;
        const relativeY = y * size;
        ctx.fillRect(relativeX, relativeY, size, size);
        const pad = (val) => val.toString().padStart(2, '0')
        const xLog = pad(`${relativeX / size}`)
        const yLog = pad(`${relativeY / size}`)
        const indexLog = pad(colors.indexOf(ctx.fillStyle.toUpperCase()));
        const logLine = new Coord(xLog, yLog, indexLog)

        const anyMatch = log.filter((coord) => coord.x == logLine.x && coord.y == logLine.y && coord.colorIndex == indexLog)
        if (anyMatch.length == 0) {
          log.push(logLine)
        }
        search = new URLSearchParams(window.location.search)

        const location = window.location.href.split("?")[0] + `?draw=${log.map(({x, y, colorIndex}) => `${x}${y}${colorIndex}`).join("-")}`
        url.href = location
      }


      game.onmousedown = (e) => {
        const x = Math.floor((e.clientX - boundaries.left) / size);
        const y = Math.floor((e.clientY - boundaries.top) / size);
        draw(x, y)
      };


      if (window.location.search != "") {
        const search = new URLSearchParams(window.location.search)
        for (let pixel of search.get("draw").split("-")) {
          const x = parseInt(pixel.slice(0, 2), 10);
          const y = parseInt(pixel.slice(2, 4), 10);
          const colorIndex = parseInt(pixel.slice(4, 6), 10);

          draw(x, y, colorIndex)
        }
      }



    </script>
  </body>
</html>
