<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Adding Your Own Differ to RSpec - Ryan Bigg</title>
  <link rel="shortcut icon" href="https://ryanbigg.com/favicon.png" type="image/x-icon">
  <link href="/feed.xml" rel="alternate" title="RyanBigg.com" type="application/atom+xml" />
  <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:400,700|Ubuntu+Mono:400,700,700i&display=swap"
    rel="stylesheet">
  <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'>
  <link rel='stylesheet' href='/css/style.css' media='screen'>
  <link rel='stylesheet' href='/css/highlighting.css' media='screen'>
  <script src="/js/highlight.js"></script>
  <script>hljs.highlightAll();</script>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <meta content="RyanBigg.com - Adding Your Own Differ to RSpec" property="og:title">
  
  <meta property="og:site_name" content="Ryan Bigg">
  <meta property="og:url" content="https://ryanbigg.com">
  
  <meta content="" property="og:description">
  
  <meta property="og:type" content="article">
  <meta property="og:image" content="https://ryanbigg.com/images/me.jpg">
</head>


<body>
  <div class="main">
    <div class='content'>
      <div class='content-inner'>
        <article>
          <div class='text-center mb-8'>
            <a href="/blog">&#x27F5; Posts</a>
            <a href="/2009/07/adding-your-own-differ-to-rspec">
              <h2>Adding Your Own Differ to RSpec</h2>
            </a>
            <small>17 Jul 2009</small>
          </div>
          <p>Recently I <a href="https://rspec.lighthouseapp.com/projects/5645/tickets/848-diff_as_hash">added diff_as_hash to rspec</a> and I’d like to show you what I did, so you can add your own differs, and it’s only a couple of lines of code. You can edit your own local gem copy of rspec using the find_gem gem’s edit_gem command.</p>

<p>Let’s use the example that you want to add a BigDecimal differ.</p>

<h3><em>lib/spec/expectations/fail_with.rb</em></h3>

<p>First of all you’re going to need to add a line to this file, something that looks like the lines here, along with the other <span class="term">elsif</span>s:</p>

<script src="http://gist.github.com/148909.js"></script>

<h3><em>lib/spec/runner/differs/default.rb</em></h3>

<p>Secondly, in this file inside the <span class="term">Spec::Expectations::Differs::Default</span> class you’ll have to define your <span class="term">diff_as_big_decimal</span> differ:</p>

<script src="http://gist.github.com/148912.js"></script>

<p>Now when you diff BigDecimal numbers in your rspec tests, you’ll see this output, rather than the ugly output.</p>

<p>However, what would be nicer is if you could expand on this diffing syntax in your own project, rather than having to hack rspec and have it wiped next time you upgrade. More on that later though.</p>


        </article>
      </div>
    </div>
  </div>
  <footer>
</footer>


  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-60556315-1', 'auto');
    ga('send', 'pageview');

  </script>
</body>

</html>
